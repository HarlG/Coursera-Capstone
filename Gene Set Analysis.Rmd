---
title: "Gene Set Analysis"
author: "Harlan Gillespie"
date: "21/10/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Dependencies

```{r Dependencies, message=FALSE}
library(AnnotationHub)
library(TxDb.Hsapiens.UCSC.hg19.knownGene)
```


## Load the data

The 'genes_logFC.tsv' file created in Statistical Analysis previously is read and stored as a data.frame.

```{r}
df = read.table(file = 'genes_logFC.tsv', sep = '\t', header = TRUE)
```

Next, the fetal and adult upregulated genes are separated. Adult sample was used as a a control so upregulated fetal genes are labeled "up" and upregulated adult genes are labeled "down".

```{r}
up = df[df$logFC > 0,]
down = df[df$logFC < 0,]
```

## Get Annotations

Using AnnotationHub, the data from the roadmap epigenomics project containing locations of promoter associated histone modification H3K4me3 narrow peaks in human brain samples for adult and fetal samples.
```{r}
ah = AnnotationHub()
ah = subset(ah, species == "Homo sapiens")
qhs = query(ah, "H3K4me3")
qbrain = query(qhs, c("brain", "narrowPeak"))
qfetal = query(qbrain, "fetal")

```

We are looking for a consolidated dataset. As 4 out of 6 of our samples are male and sex was not determined in PCA to be a significant covariate, we will use only the male data, E081.

```{r}
qfetal$tags
fetal.brain.gr = qfetal[[1]]
```

E073 sample was chosen for the adult dataset as it represents H3K4me3 narrow peaks for the dorsolateral prefrontal cortex in ~80 year old males. Our samples are from people aged 36-42 years however this should suffice for comparison to fetal samples.

```{r}
qbrain$tags
adult.brain.gr = qbrain[[7]]
```

Now to find 


## Finding hg19 promoters that overlap with H3K4me3 peaks and annotation

```{r}
refseq <- ah[ah$genome == "hg19" & ah$title == "RefSeq Genes"][[1]]
prom = promoters(refseq)
prom = reduce(prom, ignore.strand = TRUE)
```


```{r}

```



